<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>계산기</title>
<style>
  body {
    display: flex;
    justify-content: center;
    padding-top: 30px;
    font-family: Arial, sans-serif;
  }
  .calculator-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .display {
    width: 260px;
    height: 50px;
    margin-bottom: 15px;
    font-size: 28px;
    text-align: right;
    padding-right: 10px;
    border-radius: 5px;
    border: 2px solid #ccc;
    background-color: #f0f0f0;
  }
  .calculator {
    display: grid;
    grid-template-columns: repeat(4, 60px);
    grid-gap: 10px;
  }
  .calculator button {
    height: 60px;
    font-size: 20px;
    border: none;
    cursor: pointer;
    color: white;
    border-radius: 5px;
  }
  /* 첫 줄 버튼 4개 빨간색 */
  .calculator button:nth-child(-n+4) {
    background-color: red;
  }
  /* 두 번째 줄 버튼 4개 파란색 */
  .calculator button:nth-child(n+5):nth-child(-n+8) {
    background-color: blue;
  }
  /* 3~5번째 줄 버튼 회색 */
  .calculator button:nth-child(n+9) {
    background-color: gray;
  }
</style>
</head>
<body>

<div class="calculator-wrapper">
  <input type="text" class="display" readonly value="0" />
  <div class="calculator">
    <button>7</button>
    <button>8</button>
    <button>9</button>
    <button>÷</button>

    <button>4</button>
    <button>5</button>
    <button>6</button>
    <button>×</button>

    <button>1</button>
    <button>2</button>
    <button>3</button>
    <button>−</button>

    <button>0</button>
    <button>.</button>
    <button>=</button>
    <button>+</button>

    <button>AC</button>
    <button>±</button>
    <button>%</button>
    <button>√</button>
  </div>
</div>

<script>
  const display = document.querySelector('.display');
  const buttons = document.querySelectorAll('.calculator button');

  let currentInput = '';
  let resultDisplayed = false;

  function calculateExpression(expr) {
    // 수식에 들어가는 기호를 자바스크립트 연산자로 변환
    expr = expr.replace(/÷/g, '/').replace(/×/g, '*').replace(/−/g, '-');
    try {
      let result = Function(`return ${expr}`)();
      if (Number.isFinite(result)) {
        return result;
      } else {
        return 'Error';
      }
    } catch {
      return 'Error';
    }
  }

  buttons.forEach(btn => {
    btn.addEventListener('click', () => {
      const val = btn.textContent;

      if (val === 'AC') {
        currentInput = '';
        display.value = '0';
        resultDisplayed = false;
        return;
      }

      if (val === '=') {
        if (currentInput === '') return;
        let res = calculateExpression(currentInput);
        display.value = res;
        currentInput = res.toString();
        resultDisplayed = true;
        return;
      }

      if (val === '±') {
        if (currentInput === '') return;
        // 현재 숫자를 부호 반대로 바꾸기
        if (currentInput.startsWith('-')) {
          currentInput = currentInput.substring(1);
        } else {
          currentInput = '-' + currentInput;
        }
        display.value = currentInput;
        return;
      }

      if (val === '%') {
        if (currentInput === '') return;
        let num = parseFloat(currentInput);
        if (!isNaN(num)) {
          num = num / 100;
          currentInput = num.toString();
          display.value = currentInput;
        }
        return;
      }

      if (val === '√') {
        if (currentInput === '') return;
        let num = parseFloat(currentInput);
        if (!isNaN(num)) {
          if (num < 0) {
            display.value = 'Error';
            currentInput = '';
          } else {
            num = Math.sqrt(num);
            currentInput = num.toString();
            display.value = currentInput;
          }
        }
        return;
      }

      // 숫자 또는 연산자 입력 처리
      // 연산자 연속 입력 방지, 소수점 중복 입력 방지 등 기본 체크

      if (resultDisplayed) {
        // 결과 바로 다음에 숫자 누르면 새 입력 시작
        if ('0123456789.'.includes(val)) {
          currentInput = val;
          display.value = currentInput;
          resultDisplayed = false;
          return;
        } else {
          resultDisplayed = false;
        }
      }

      const operators = ['+', '−', '×', '÷'];
      const lastChar = currentInput.slice(-1);

      if (operators.includes(val)) {
        // 연산자가 처음이면 입력 무시
        if (currentInput === '') return;
        // 마지막이 연산자면 교체
        if (operators.includes(lastChar)) {
          currentInput = currentInput.slice(0, -1) + val;
          display.value = currentInput;
          return;
        }
      }

      if (val === '.') {
        // 현재 숫자에 이미 '.' 있으면 무시
        // 마지막 숫자 부분만 검사
        const parts = currentInput.split(/[\+\−\×\÷]/);
        const lastPart = parts[parts.length -1];
        if (lastPart.includes('.')) return;
      }

      currentInput += val;
      display.value = currentInput;
    });
  });
</script>

</body>
</html>
